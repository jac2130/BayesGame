function makeCounterButton(menu, post, betView)
{
    var counterButton = makeButton("Go!", 58, 25);
    var callback = {
        "bet": menu,
	"post": post,
	'betView':betView,
        "call": function() {
            var theBet=this.bet.activeChoice;
	    var permalink=this.post.permalink;
	    var id=this.post['id'];
	    var betView=this.betView;
	   
	    console.log(id)
	    if (["A","B","C"].indexOf(theBet)>=0)
{
$.ajax({
    type: "post",
    url: '/ajax/newcomment',
    async: true,
    data:JSON.stringify({"commentName":user.name, "commentEmail":"","commentBody": theBet, "permalink":permalink, "id":id}),
    dataType: "json",
    contentType: "application/json",
    success: function(user){alert(user.name)} 
    
});

//delete betting view and recreate new one
    var width=betView.width;
    var height=betView.height;
    betView.erase() ;
    betView=makeBettingView(width, height, betView.bayesVar);
    betView.shape.scaleX = 0.5;
    betView.shape.scaleY = 0.5;
    betView.render(stage, Point(100, 70));
}
	    else {alert("you must first choose a value for your counter bet!")}
        }
    };
    makeClickable(counterButton, callback);
    return counterButton;
}


function makeBetButton(betView)
{
    var betButton = makeButton("Place Bet!", 200, 45);
    var callback = {
        "bet": betView.bettingMenu,
	"points":betView.pointMenu,
	'betView':betView,
        "call": function() {
            var theBet=this.bet.activeChoice;
	    var points=this.points.activeChoice;
	    var betView=this.betView;
	    if (["A","B","C"].indexOf(theBet)>=0 && range(101).indexOf(points))
{ 
$.ajax({
    type: "post",
    url: '/ajax/newpost',
    async: true,
    data:JSON.stringify({"subject":theBet, 'body':points, 'comments':[]}),
    dataType: "json",
    contentType: "application/json",
    success: function(user){alert(user.name)} 
    
});

//delete betting view and create new one.
    var width=betView.width;
    var height=betView.height;
    betView.erase() ;
    betView=makeBettingView(width, height, betView.bayesVar);
    betView.shape.scaleX = 0.5;
    betView.shape.scaleY = 0.5;
    betView.render(stage, Point(100, 70));
}
	    else {alert("you must first choose a value for your bet and you must decide how many points you want to bet!")}
        }
    };
    makeClickable(betButton, callback);
    return betButton;
}


var BettingView = Object.create(Widget);

function makeBettingView(graphWidth, graphHeight, bayesVar)
{
    var borderWidth = 1;
    var betView = Object.create(BettingView);
    betView.width=graphWidth;
    betView.height=graphHeight;
    betView.setShape(new createjs.Container());
    betView.background = makeRect(graphWidth, graphHeight, "#f0f0f0", borderWidth);
    betView.background.render(betView.shape, {x:0, y:0});
    betView.bayesVar=bayesVar;

    var nextYPosition = 120;

    betView.bigButton = makeRect(graphWidth/5, graphWidth/5,"#3B4DD0", 4, "#460595");

    betView.bigButton.render(betView.shape, {x:nextYPosition, y:nextYPosition});

    betView.enterBet = makeTextWidget("Enter Your Bet:", 26, "Arial", "#ffffff");
    betView.enterBet.render(betView.shape, {x:nextYPosition+30, y:nextYPosition+10})

    betView.enterPoints = makeTextWidget("How Many Points?:", 26, "Arial", "#ffffff");
    betView.enterPoints.render(betView.shape, {x:nextYPosition+30, y:nextYPosition+125})

    betView.pointMenu = makeDropDownMenu(["10", "20", "30", "40", "50", "60", "70", "80", "90", "100"], 210, 45, "white","Select Value")
    betView.pointMenu.render(betView.shape, {x:nextYPosition+30, y:nextYPosition+175})

    betView.bettingMenu = makeDropDownMenu(["A", "B", "C"], 210, 45, "white","Select Value")
    betView.bettingMenu.render(betView.shape, {x:nextYPosition+30, y:nextYPosition+65})

    betView.betButton = makeBetButton(betView)
    betView.betButton.render(betView.shape, {x:nextYPosition+30, y:nextYPosition+245})

 
    var betWidth = 300;
    var betHeight=90
    var betSpacing = 60;
    var distBetweenYs = betHeight + betSpacing;
    betView.Posts=[];
    betView.WidgetList=[]
    betView.addPost = function(post)
    {
        var postItem = WidgetHL();
	postItem.post = post;
        post.postItem = postItem;
	this.Posts.push(post)
	post.betView=this;

        postItem.postButton = makeRect(betWidth,betHeight,"#3B4DD0", 4, "#460595");
        postItem.postButton.renderW(postItem, {x:300, y:20});
	
	

	postItem.text = makeTextWidget("Enter counter bet:", 26, "Arial", "#ffffff");
	postItem.text.renderW(postItem, {x:310, y:20});

        postItem.bet = makeTextWidget(post.title, 46, "Arial", "#666");

	postItem.bet.renderW(postItem, {x:0, y:20});

	postItem.points = makeTextWidget(post.body, 46, "Arial", "#666");

	postItem.points.renderW(postItem, {x:200, y:20});
	
	postItem.place=nextYPosition;

	comments=""
	counter=0;
	if ("comments" in post)
	{

	    if (post.comments.length>=1)
	    {
		nextYPosition+=betSpacing;
		counter+=post.comments.length;
	    };
	    counter= "Counter Bets: " + String(counter) + "\n\n";

	    postItem.counter=makeTextWidget(counter, 22, "Arial", "#460595");
	    postItem.counter.renderW(postItem, {x:-50, y:100});

	    for (i in post.comments)
	    {
		if (post.comments[i].body!=undefined)
		{
		    comments+="\n" + post.comments[i].body + "   " +post.comments[i].author + "\n"
		    nextYPosition+=betSpacing;
		}
	    
	    }
	}
	postItem.comments=makeTextWidget(comments, 26, "Arial", "green");
	postItem.comments.renderW(postItem, {x:30, y:130});

	postItem.menu = makeDropDownMenu(["A", "B", "C"], 210, 45, "white","Select Counter Bet")
	postItem.menu.renderW(postItem, {x:310, y:60});

	postItem.counterButton=makeCounterButton(postItem.menu, postItem.post, postItem.post.betView)
	postItem.counterButton.renderW(postItem, {x:530, y:70});

	//postItem.render(this.shape, {x:700, y:postItem.place});
        nextYPosition += distBetweenYs;
	return postItem;
    };

    $.ajax({
    type: "GET",
    url: '/ajax/',
    async: true,
    
    dataType: "json",
    success: function(data){
	user_data=data//do your stuff with the JSON data;
	posts=user_data.myposts;
	postItems=[]
	for (i in [0, 1, 2, 3])
{
    postItem = betView.addPost(posts[i])
    postItems.push(postItem)
	  
}
	for (var i=3;i>=0;i--)
{
    postItems[i].render(betView.shape, {x:700, y:postItems[i].place});	    
}

	}})

    return betView;
}

//var filename='/ajax'+'/hello/' + user.id;

//$.ajax({
//    type: "GET",
//    url: filename,
//    async: true,
    
//    dataType: "json",
//    success: function(data){
//	alert(data.name)//do your stuff with the JSON data
//    }
//});

//$.ajax({
//    type: "post",
//    url: '/ajax/posthere',
//    async: true,
//    data:JSON.stringify(user),
//    dataType: "json",
//    contentType: "application/json",
//    success: function(data){
//        alert(data.name)//do your stuff with the JSON data                      
//    }
//});

